<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tabirly | Tarot Tool v4.3</title>
<meta name="description" content="Tabirly tarot aÃ§Ä±lÄ±mlarÄ±: Tek Kart, 3 Kart, Kelt HaÃ§Ä±, Ä°liÅŸki AÃ§Ä±lÄ±mÄ±. SeÃ§meli mod, paylaÅŸÄ±m, localStorage, gÃ¶rsel indir, TR/EN, tema." />
<meta property="og:title" content="Tabirly | Tarot Tool" />
<meta property="og:description" content="Tek Kart, 3 Kart, Kelt HaÃ§Ä±, Ä°liÅŸki aÃ§Ä±lÄ±mÄ±â€”sonucu link ve gÃ¶rsel olarak paylaÅŸ." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://tarot.tabirly.com" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%237f5af0'/><stop offset='1' stop-color='%23ffd166'/></linearGradient></defs><rect rx='14' width='64' height='64' fill='url(%23g)'/></svg>">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<style>
:root{
  /* ---- Dark (varsayÄ±lan) pastel tonlar ---- */
  --bg: #0e1118;
  --bg2: #111828;
  --card:#161b2a;
  --ink:#eef3ff;           /* yazÄ±lar full aÃ§Ä±k */
  --muted:#9fb0c7;
  --acc1:#7fb8ff;          /* baby blue (dark versiyon) */
  --acc2:#79e9d3;          /* su yeÅŸili (dark versiyon) */
  --acc3:#b79cff;          /* baby purple (dark versiyon) */

  --radius:14px;
  --gap:12px;
  --shadow:0 10px 28px rgba(0,0,0,.35);

  /* Boyutlar â†“ (yarÄ±/kompakt) */
  --card-pad:10px;
  --title-size:14px;
  --mini-size:11px;
  --long-size:12px;
  --badge-size:11px;
}

/* Genel reset & layout */
*{box-sizing:border-box}
body{
  margin:0;
  background:
    radial-gradient(1000px 700px at 15% -10%, var(--bg2) 0%, var(--bg) 55%),
    var(--bg);
  color:var(--ink);
  font:15px/1.6 system-ui, Inter, Roboto, Arial, sans-serif;
}
.wrap{max-width:1000px;margin:24px auto;padding:0 12px 64px}
header{display:flex;gap:12px;align-items:center;margin:0 0 12px}
.logo{width:38px;height:38px;border-radius:10px;
  background:conic-gradient(from 0deg, var(--acc3), var(--acc1), var(--acc2), var(--acc3))}
.hgroup h1{margin:0;font-size:20px}
.hgroup p{margin:.25rem 0 0;color:var(--muted);font-size:13px}

.panel{
  background:rgba(22,27,42,.65);
  border:1px solid rgba(255,255,255,.06);
  backdrop-filter:blur(6px);
  border-radius:var(--radius);
  padding:12px;
  box-shadow:var(--shadow);
}
.controls{
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:var(--gap);
  align-items:end;
}
@media(max-width:700px){.controls{grid-template-columns:1fr}}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
select,input{
  width:100%;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f1423;
  color:var(--ink);
  padding:8px 9px;
  font:inherit;
}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}

/* Butonlar pastel degrade */
.btn{
  border:0;border-radius:12px;padding:10px 14px;
  background:linear-gradient(180deg, var(--acc1), var(--acc2));
  color:#0c0f14;font-weight:700;cursor:pointer;
  box-shadow:0 6px 18px rgba(127,184,255,.25);
}
.btn.small{padding:7px 10px;font-weight:600}

/* GRID â€” kartlar kÃ¼Ã§Ã¼ldÃ¼ */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:var(--gap);
  margin:14px 0;
}
#board[data-type="celtic"]{grid-template-columns:repeat(5,1fr)}
@media (max-width:900px){#board[data-type="celtic"]{grid-template-columns:repeat(3,1fr)}}
#board[data-type="relation"]{grid-template-columns:repeat(3,1fr)}

/* KART */
.tarot-card{
  position:relative;
  aspect-ratio:3/5;
  border-radius:12px;
  transform-style:preserve-3d;
  transition:transform .65s cubic-bezier(.2,.6,.2,1);
  box-shadow:var(--shadow);
  cursor:pointer;
  will-change:transform;
  max-width: 240px;   /* ğŸ”¹ ekledim: kartÄ±n geniÅŸliÄŸini sÄ±nÄ±rla */
   justify-self:center;   /* ğŸ”¹ eklendi (tek kart bazÄ±nda da ortala) */
}
.tarot-card.flipped{transform:rotateY(180deg)}
.tarot-card .face{
  position:absolute;inset:0;display:grid;place-items:center;
  backface-visibility:hidden;border-radius:12px;overflow:hidden
}
.tarot-card .back{
  background:
    linear-gradient(135deg, rgba(127,184,255,.18), rgba(121,233,211,.12)),
    repeating-radial-gradient(circle at 50% 38%, #202744 0 7px, #1a2240 7px 14px);
}
.tarot-card .front{
  transform:rotateY(180deg);
  background:#141a2d;
  padding:var(--card-pad);
  text-align:center;
  border:1px solid rgba(255,255,255,.08);
  position:relative;
}
.tarot-card .front img.bg{
  position:absolute;inset:0;width:100%;height:100%;
  object-fit:cover;opacity:.26;
  filter:contrast(1.05) saturate(1.05) brightness(.9)
}

/* Ä°Ã§ tipografi (kÃ¼Ã§Ã¼ltÃ¼ldÃ¼) */
.title{font-weight:800;margin-top:6px;font-size:var(--title-size)}
.mini{font-size:var(--mini-size);color:var(--muted);margin-top:3px}
.long{font-size:var(--long-size);margin-top:6px;line-height:1.45;color:var(--ink)}

/* Rozetler kÃ¼Ã§Ã¼k */
.pos-badge,.rev-badge{
  position:absolute;top:6px;padding:3px 7px;border-radius:9px;
  font-size:var(--badge-size)
}
.pos-badge{left:6px;background:rgba(0,0,0,.45);color:#fff}
.rev-badge{right:6px;background:rgba(239,71,111,.92);color:#fff;display:none}
.tarot-card.is-reversed .rev-badge{display:inline-block}

/* Ters kartlarda SADECE gÃ¶rseli Ã§evir (metin dÃ¼z) */
.tarot-card.is-reversed .front img.bg{transform:rotate(180deg)}

/* Shuffle animasyonu */
@keyframes shuffleSpin{0%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}100%{transform:rotate(0)}}
.shuffle .tarot-card{animation:shuffleSpin .22s ease both}

footer{margin-top:22px;color:var(--muted);font-size:11px;text-align:center}
.inline{display:flex;align-items:center;gap:8px}
.muted{color:var(--muted);font-size:12px}

/* ---- LIGHT THEME: sweet pastel (baby blue, sea green, baby purple) ---- */
[data-theme="light"]{
  --bg:#f4f7ff;
  --bg2:#ecf4ff;
  --card:#ffffff;
  --ink:#0b0d12;           /* yazÄ±lar full koyu */
  --muted:#4a5a70;
  --acc1:#B3D8FF;          /* baby blue */
  --acc2:#B6F2E3;          /* su yeÅŸili */
  --acc3:#D5C6FF;          /* baby purple */

  --shadow:0 8px 20px rgba(15,23,42,.08);
}
[data-theme="light"] body{
  background:
    radial-gradient(1000px 700px at 18% -10%, var(--bg2) 0%, var(--bg) 60%),
    var(--bg);
}
[data-theme="light"] .panel{
  background:#ffffffcc;
  border:1px solid rgba(15,23,42,.06);
}
[data-theme="light"] select,
[data-theme="light"] input{
  background:#ffffff;
  color:var(--ink);
  border:1px solid rgba(15,23,42,.12);
}
[data-theme="light"] .btn{
  background:linear-gradient(180deg, var(--acc1), var(--acc3));
  color:#091016;
  box-shadow:0 6px 16px rgba(181,209,255,.35);
}
[data-theme="light"] .tarot-card .back{
  background:
    linear-gradient(135deg, rgba(179,216,255,.45), rgba(214,198,255,.35)),
    repeating-radial-gradient(circle at 50% 38%, #e8efff 0 7px, #dee9ff 7px 14px);
}
[data-theme="light"] .tarot-card .front{
  background:linear-gradient(180deg,#ffffff,#f7f9ff);
  border:1px solid rgba(15,23,42,.08);
}
[data-theme="light"] .pos-badge{
  background:rgba(9,16,22,.08); color:#091016;
}
[data-theme="light"] .rev-badge{
  background:#ef476f; color:#fff;
}
/* YalnÄ±zca dil/tema seÃ§icileri dar tut (renkler temadan gelir) */
.compact-select{ width:auto; }

/* Ä°stersen ok ikonunu sadeleÅŸtir (opsiyonel) */
select{ appearance:auto; } /* Safari iÃ§in: -webkit-appearance:auto; */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:var(--gap);
  margin:14px 0;
  justify-items: center;   /* ğŸ”¹ eklendi */
}
.tarot-card .front{
  transform:rotateY(180deg);
  background: var(--card);     /* ğŸ”¹ #141a2d yerine */
  padding:var(--card-pad);
  text-align:center;
  border:1px solid rgba(255,255,255,.08);
  position:relative;
}
.grid{ justify-items:center; }
.tarot-card{ width:100%; max-width:120px; justify-self:center; }

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div class="hgroup">
        <h1>Tabirly Tarot v4.3</h1>
        <p>Tek Kart, 3 Kart, Kelt HaÃ§Ä±, Ä°liÅŸki â€¢ SeÃ§meli mod â€¢ PaylaÅŸ/GÃ¶rsel â€¢ LocalStorage â€¢ TR/EN â€¢ Tema</p>
      </div>
    </header>

    <section class="panel" aria-label="AÃ§Ä±lÄ±m AyarlarÄ±">
      <div class="controls">
        <div>
          <label for="spread">AÃ§Ä±lÄ±m tÃ¼rÃ¼</label>
          <select id="spread">
            <option value="one">Tek Kart</option>
            <option value="three">3 Kart (GeÃ§miÅŸâ€“Åimdiâ€“Gelecek)</option>
            <option value="celtic">Kelt HaÃ§Ä± (10 kart)</option>
            <option value="relation">Ä°liÅŸki AÃ§Ä±lÄ±mÄ± (6 kart)</option>
          </select>
        </div>
        <div>
          <label for="question">Soru (isteÄŸe baÄŸlÄ±)</label>
          <input id="question" type="text" placeholder="Ã–rn. Ä°liÅŸkide nasÄ±l ilerlemeliyim?">
        </div>
        <div>
          <button id="deal" class="btn">KartlarÄ± Ã‡ek</button>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <label class="inline"><input type="checkbox" id="allowReversed" checked style="accent-color:#ffd166"/> Ters kart</label>
        <label class="inline"><input type="checkbox" id="autoFlip" checked style="accent-color:#ffd166"/> Otomatik flip</label>
        <label class="inline"><input type="checkbox" id="showImages" style="accent-color:#ffd166"/> Kart gÃ¶rselleri</label>
        <label class="inline"><input type="checkbox" id="pickMode" style="accent-color:#ffd166"/> SeÃ§meli mod</label>
        <label class="inline">Dil:
          <select id="lang"  class="compact-select">
  <option value="tr">TÃ¼rkÃ§e</option>
  <option value="en">English</option>
</select>

            <option value="tr">TÃ¼rkÃ§e</option>
            <option value="en">English</option>
          </select>
        </label>
        <label class="inline">Tema:
          <select id="theme" style="width:auto;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0f1320;color:var(--ink)">
            <option value="dark">Koyu</option>
            <option value="light">AÃ§Ä±k</option>
          </select>
        </label>
      </div>
      <p class="muted">GÃ¶rseller yoksa iÅŸaretleme. AÃ§Ä±lÄ±mÄ± paylaÅŸtÄ±ÄŸÄ±nda linkten aynÄ± sonuÃ§ aÃ§Ä±lÄ±r.</p>
    </section>

    <section class="panel" id="extras">
      <div class="row" id="sharebar" hidden>
        <button class="btn small" id="copyLink">Linki kopyala</button>
        <button class="btn small secondary" id="shareWa">WhatsApp</button>
        <button class="btn small secondary" id="shareX">X / Twitter</button>
        <button class="btn small" id="savePng">GÃ¶rsel indir (PNG)</button>
      </div>
    </section>

    <section id="deck" class="grid" hidden aria-label="Deste"></section>
    <section id="board" class="grid" aria-live="polite" aria-busy="false"></section>

    <section id="explain" class="panel" hidden>
      <p id="summary">Kartlara tÄ±klayarak Ã§evir. Ayarlardan ters kartÄ± ve otomatik flipâ€™i yÃ¶net. SeÃ§meli mod aÃ§Ä±kken, desteden sÄ±rasÄ±yla gerekli sayÄ±da kart seÃ§.</p>
    </section>

    <footer><p>Â© Tabirly â€” Tarot Tool v4.3</p></footer>
  </div>

<script>
// ---- Tarot veri seti (uzun yorumlu) ----
const TAROT=(()=>{const U=(u,r,ul='',rl='')=>({upright:u,reversed:r,longU:ul||u,longR:rl||r});const majors={
  "The Fool":U("BaÅŸlangÄ±Ã§, cesaret, akÄ±ÅŸa gÃ¼ven","DÃ¼ÅŸÃ¼ncesizlik, hazÄ±rlÄ±ksÄ±z risk","Yeni bir sayfa; Ã§ocuk merakÄ±yla adÄ±m. Korku yerine deneyim ve Ã¶ÄŸrenme.","PlansÄ±z atÄ±lÄ±mÄ±n bedeli olabilir; Ã¶nce niyetini netle."),
  "The Magician":U("Niyet, odak, eylem gÃ¼cÃ¼","DaÄŸÄ±lan enerji, yanÄ±lsama","KaynaklarÄ±nÄ± tek bir hedefe hizala; sÃ¶yle-dÃ¼ÅŸÃ¼n-yap uyumu.","HokkabazlÄ±k ve daÄŸÄ±nÄ±k gÃ¼ndem sonuÃ§ vermez; odaÄŸÄ±nÄ± topla."),
  "The High Priestess":U("Sezgi, sÄ±r, iÃ§e dÃ¶nÃ¼ÅŸ","Gizlilik, kopukluk","Cevap iÃ§erde; sessizlikte bilgi aÃ§Ä±lÄ±r.","AÅŸÄ±rÄ± iÃ§ine kapanma iletiÅŸimi zayÄ±flatÄ±r."),
  "The Empress":U("Bereket, bakÄ±m, yaratÄ±m","AÅŸÄ±rÄ± koruma, tÄ±kanma","Ãœret, besle, bÃ¼yÃ¼t; doÄŸa ritmi.","AÅŸÄ±rÄ± sahiplenme yaratÄ±mÄ± boÄŸuyor olabilir."),
  "The Emperor":U("DÃ¼zen, yapÄ±, otorite","KatÄ±lÄ±k, kontrol","SÄ±nÄ±r, kural ve strateji; liderlik.","Esneklik eksikliÄŸi Ã§atÄ±ÅŸma doÄŸurur."),
  "The Hierophant":U("Gelenek, rehberlik","KÃ¶r uyum, dogma","Usta-Ã§Ä±rak bilgisi; ritÃ¼el faydalÄ±.","SÄ±rf gelenek diye tutunma."),
  "The Lovers":U("SeÃ§im, uyum, baÄŸ","KararsÄ±zlÄ±k, uyumsuzluk","Kalp-zihin hizasÄ±yla seÃ§im.","Belirsizlik baÄŸa zarar verir; netleÅŸ."),
  "The Chariot":U("Ä°rade, yÃ¶n, zafer","Dengesizlik","Tek yÃ¶ne Ã§ek; dizginler sende.","HÄ±z var, denge yoksa savrulursun."),
  "Strength":U("Sakin gÃ¼Ã§, sabÄ±r","SabÄ±rsÄ±zlÄ±k","YumuÅŸak gÃ¼Ã§, ÅŸefkatle hÃ¼kmet.","ZorlamayÄ± bÄ±rak; sabÄ±r eksik."),
  "The Hermit":U("Ä°Ã§ arayÄ±ÅŸ","Ä°zolasyon","YalnÄ±zlÄ±kta iÃ§ Ä±ÅŸÄ±k; araÅŸtÄ±r.","KopuÅŸu fark et; dÃ¼nyaya dÃ¶n."),
  "Wheel of Fortune":U("DÃ¶ngÃ¼, fÄ±rsat","Talihsizlik dÃ¶ngÃ¼sÃ¼","Zaman dÃ¶ner; kapÄ± aÃ§Ä±lÄ±r.","AynÄ± dÃ¶ngÃ¼ye direnme; dersi al."),
  "Justice":U("Adalet, denge","HaksÄ±zlÄ±k","TarafsÄ±z muhakeme; sÃ¶zÃ¼nde dur.","Eksik veriyle hÃ¼kÃ¼m verme."),
  "The Hanged Man":U("BakÄ±ÅŸ aÃ§Ä±sÄ± deÄŸiÅŸimi","Tutukluk","AskÄ±da kalÄ±ÅŸ yeni gÃ¶rÃ¼ÅŸ kazandÄ±rÄ±r.","KÃ¶r fedakÃ¢rlÄ±k enerjiyi tÃ¼ketir."),
  "Death":U("BitiÅŸ ve dÃ¶nÃ¼ÅŸÃ¼m","DeÄŸiÅŸime direnÃ§","KapanÄ±ÅŸ=doÄŸum; kabuk yenilenir.","Eskiyi bÄ±rakma korkusu ilerletmiyor."),
  "Temperance":U("Denge, Ä±lÄ±mlÄ±lÄ±k","AÅŸÄ±rÄ±lÄ±k","Harmanla, Ã¶lÃ§Ã¼yÃ¼ bul.","AÅŸÄ±rÄ±lar seni savuruyor."),
  "The Devil":U("BaÄŸ, gÃ¶lge","KurtuluÅŸ","BaÄŸÄ±mlÄ±lÄ±ÄŸÄ± gÃ¶r; sorumluluÄŸu al.","Zinciri fark ettin; adÄ±m at."),
  "The Tower":U("Ani yÄ±kÄ±m, uyanÄ±ÅŸ","Geciken kriz","Ã‡Ã¼rÃ¼k yapÄ± yÄ±kÄ±lÄ±r; hakikat kalÄ±r.","Ertelenen Ã§Ã¶kÃ¼ÅŸ daha sert olur."),
  "The Star":U("Umut, ilham","ÅÃ¼phe","Yaran iyileÅŸiyor; suya bak.","Ä°nancÄ± tazele; kÃ¼Ã§Ã¼k adÄ±m."),
  "The Moon":U("Belirsizlik, sezgi","YanÄ±lsama","Sisli yolda sezgi pusula.","Kuruntuyla gerÃ§eÄŸi karÄ±ÅŸtÄ±rma."),
  "The Sun":U("Netlik, baÅŸarÄ±","AÅŸÄ±rÄ± iyimserlik","Ã‡ocuk neÅŸesi; gÃ¶rÃ¼nÃ¼r baÅŸarÄ±.","Ego parlÄ±yor; ekip gÃ¶lgede kalmasÄ±n."),
  "Judgement":U("Ã‡aÄŸrÄ±, yenilenme","Erteleme","Kendini Ã§aÄŸÄ±r; eski dosyayÄ± kapat.","Korku yÃ¼zÃ¼nden ertelediÄŸin karar."),
  "The World":U("Tamamlanma","Eksik halka","DÃ¶ngÃ¼ biter; yeni sefer.","Son noktayÄ± koy; aÃ§Ä±k uÃ§ kalmasÄ±n.")};
  const SUITS=[{suit:'Cups',up:['Duygu, akÄ±ÅŸ, baÄŸ','Ä°ki kiÅŸi, uyum','Kutlama, topluluk','Duygusal Ã§ekilme','Hayal kÄ±rÄ±klÄ±ÄŸÄ±','Nostalji','Hayaller, seÃ§enekler','Veda, yolculuk','Dilek, tatmin','Duygusal tamamlanma']},{suit:'Pentacles',up:['FÄ±rsat, tohum','Denge, jonglÃ¶rlÃ¼k','UstalÄ±k, iÅŸbirliÄŸi','Tutunma, gÃ¼venlik','Yoksunluk, soÄŸuk','PaylaÅŸÄ±m, yardÄ±m','SabÄ±r, hasat','UstalÄ±k, emek','Ã–z-deÄŸer, konfor','Maddi tamamlanma']},{suit:'Swords',up:['Zihin aÃ§Ä±klÄ±ÄŸÄ±','KararsÄ±zlÄ±k','AcÄ±, kÄ±rÄ±k kalp','Dinlenme, toparlanma','Ã‡atÄ±ÅŸma','GeÃ§iÅŸ, sÄ±ÄŸÄ±nma','Strateji, gizlilik','SÄ±kÄ±ÅŸmÄ±ÅŸ his','EndiÅŸe','Zihinsel Ã§Ã¶kÃ¼ÅŸ']},{suit:'Wands',up:['KÄ±vÄ±lcÄ±m, ilham','Ufuk planÄ±','GeniÅŸleme','Kutlama, temel','Rekabet','Zafer','Savunma','HÄ±z, haber','DirenÃ§','YÃ¼k, sorumluluk']}];
  const courtUp={Cups:['Hassas haberci','Romantik yolculuk','Åefkatli yÃ¶netici','Duygusal lider'],Pentacles:['Ã–ÄŸrenci, pratik adÄ±m','GÃ¼venilir ilerleyiÅŸ','Kaynak yÃ¶netimi','Maddi liderlik'],Swords:['MeraklÄ± zihin','AtÄ±lgan eylemci','Keskin karar','MantÄ±k lideri'],Wands:['YaratÄ±cÄ± kÄ±vÄ±lcÄ±m','Macera ruhu','Karizmatik yÃ¶netici','Vizyoner lider']};
  const reversedHint={Cups:['AÅŸÄ±rÄ± duyarlÄ±lÄ±k','KaÃ§Ä±ÅŸÃ§Ä±lÄ±k','ManipÃ¼lasyon','SoÄŸukluk'],Pentacles:['ÃœÅŸengeÃ§lik','Oyalama','AÃ§gÃ¶zlÃ¼lÃ¼k','Ä°natÃ§Ä± kontrol'],Swords:['Dedikodu','DÃ¼ÅŸÃ¼ncesiz saldÄ±rÄ±','Zalimlik','KatÄ± zihin'],Wands:['YÃ¶nsÃ¼z heves','DÃ¼rtÃ¼sellik','TÃ¼kenmiÅŸlik','TiranlÄ±k']};
  const cards=[];Object.keys(majors).forEach(k=>cards.push({name:k,...majors[k]}));
  const R=['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten'];
  SUITS.forEach(({suit,up})=>{up.forEach((txt,i)=>cards.push({name:`${R[i]} of ${suit}`,upright:txt,reversed:reversedHint[suit][Math.min(i,reversedHint[suit].length-1)],longU:txt,longR:reversedHint[suit][Math.min(i,reversedHint[suit].length-1)]}));['Page','Knight','Queen','King'].forEach((r,i)=>cards.push({name:`${r} of ${suit}`,upright:courtUp[suit][i],reversed:reversedHint[suit][i],longU:courtUp[suit][i],longR:reversedHint[suit][i]}));});
  const TR={Cups:'Kupa',Pentacles:'TÄ±lsÄ±m',Swords:'KÄ±lÄ±Ã§',Wands:'DeÄŸnek',Ace:'As',Two:'Ä°ki',Three:'ÃœÃ§',Four:'DÃ¶rt',Five:'BeÅŸ',Six:'AltÄ±',Seven:'Yedi',Eight:'Sekiz',Nine:'Dokuz',Ten:'On',Page:'UÅŸak',Knight:'ÅÃ¶valye',Queen:'KraliÃ§e',King:'Kral','The Fool':'Deli','The Magician':'BÃ¼yÃ¼cÃ¼','The High Priestess':'BaÅŸrahibe','The Empress':'Ä°mparatoriÃ§e','The Emperor':'Ä°mparator','The Hierophant':'Aziz','The Lovers':'AÅŸÄ±klar','The Chariot':'SavaÅŸ ArabasÄ±','Strength':'GÃ¼Ã§','The Hermit':'ErmiÅŸ','Wheel of Fortune':'Kader Ã‡arkÄ±','Justice':'Adalet','The Hanged Man':'AsÄ±lan Adam','Death':'Ã–lÃ¼m','Temperance':'Denge','The Devil':'Åeytan','The Tower':'Kule','The Star':'YÄ±ldÄ±z','The Moon':'Ay','The Sun':'GÃ¼neÅŸ','Judgement':'Mahkeme','The World':'DÃ¼nya'};
  const trName=name=>name.includes(' of ')?(()=>{const [rank,suit]=name.split(' of ');return `${TR[suit]||suit} ${TR[rank]||rank}`;})():TR[name]||name;
  return {cards,trName};})();

const POSITIONS={one:["Mesaj"],three:["GeÃ§miÅŸ","Åimdi","Gelecek"],celtic:["Durum (Åimdi)","Engel/Ã‡apraz","GeÃ§miÅŸ Temel","YakÄ±n Gelecek","BilinÃ§/Hedef","BilinÃ§altÄ±/KÃ¶k","Ã–neri/Ben","Ã‡evre/DÄ±ÅŸ Etki","Umutlar & Korkular","OlasÄ± SonuÃ§"],relation:["Sen","Partner","BaÄŸ/Dinamik","GÃ¼Ã§lÃ¼ Yanlar","Zorluklar","OlasÄ± SonuÃ§"]};

const qs=s=>document.querySelector(s), qsa=s=>Array.from(document.querySelectorAll(s));
const el=(t,c)=>{const x=document.createElement(t); if(c)x.className=c; return x};
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a}
const slug=name=>name.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

const board=qs('#board'), deck=qs('#deck');
const dealBtn=qs('#deal'), spreadSel=qs('#spread'), qInput=qs('#question');
const allowRev=qs('#allowReversed'), autoFlip=qs('#autoFlip'), showImages=qs('#showImages'), pickMode=qs('#pickMode');
const langSel=qs('#lang'), themeSel=qs('#theme');
const summary=qs('#summary'), explain=qs('#explain');
const sharebar=qs('#sharebar'), copyBtn=qs('#copyLink'), waBtn=qs('#shareWa'), xBtn=qs('#shareX'), savePng=qs('#savePng');

const KEY='tabirly_tarot_last_v43';
const encodeState=o=>btoa(unescape(encodeURIComponent(JSON.stringify(o))));
const decodeState=s=>JSON.parse(decodeURIComponent(escape(atob(s))));
let LAST_PICKS=[];

function t(name){return langSel.value==='tr'?TAROT.trName(name):name}
function m(card){return (card.reversed?card.longR:card.longU)}   // uzun yorum
function s(card){return (card.reversed?card.reversed:card.upright)} // kÄ±sa Ã¶zet

function getState(){return{type:spreadSel.value,question:qInput.value.trim(),allowReversed:!!allowRev.checked,autoFlip:!!autoFlip.checked,showImages:!!showImages.checked,pickMode:!!pickMode.checked,lang:langSel.value,theme:themeSel.value,cards:LAST_PICKS.map((p,i)=>({name:p.name,reversed:p.reversed,pos:i}))}};
function saveLocal(st){try{localStorage.setItem(KEY,JSON.stringify(st));}catch(e){}}
function loadLocal(){try{return JSON.parse(localStorage.getItem(KEY)||'null');}catch(e){return null}}
function shareURL(st){const s=encodeState(st);return `${location.origin}${location.pathname}#s=${s}`}

function renderCard(card,type,idx){
  const c=el('div','tarot-card'); if(card.reversed)c.classList.add('is-reversed'); c.setAttribute('role','button'); c.tabIndex=0;
  const back=el('div','face back'); back.innerHTML='<span style="color:#ffd166;font-weight:800">TABIRLY</span>';
  const front=el('div','face front');
  const pos=POSITIONS[type][idx]||`Kart ${idx+1}`;
  const title=t(card.name); const short=s(card); const long=m(card);
  if(showImages && showImages.checked){ const img=new Image(); img.className='bg'; img.alt=''; img.loading='lazy'; img.src=`img/${slug(card.name)}.jpg`; img.onerror=()=>img.remove(); front.appendChild(img); }
  front.innerHTML+=`
    <div class="pos-badge">${pos}</div>
    <div class="rev-badge">${langSel.value==='tr'?'TERS':'REV'}</div>
    <div class="title">${title}</div>
    <div class="mini">${short}</div>
    <div class="long">${long}</div>`;
  c.append(back,front);
  c.addEventListener('click',()=>c.classList.toggle('flipped'));
  c.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.classList.toggle('flipped');}});
  return c;
}

function renderDeck(){ deck.innerHTML=''; deck.hidden=!pickMode.checked; if(deck.hidden) return; const type=spreadSel.value, need=(POSITIONS[type]||['Mesaj']).length; let picked=0; LAST_PICKS=[]; const d=TAROT.cards.slice(); shuffle(d);
  d.forEach(card=>{ const c=el('div','tarot-card'); const back=el('div','face back'); const front=el('div','face front'); front.innerHTML='<div class="title">SeÃ§ildi / Picked</div>'; c.append(back,front); c.addEventListener('click',()=>{ if(c.classList.contains('chosen')||picked>=need) return; const reversed=allowRev.checked?(Math.random()<.5):false; LAST_PICKS.push({...card,reversed}); picked++; c.classList.add('chosen','flipped'); if(picked===need) drawFromPicks(); }); deck.appendChild(c); });
}
function drawFromPicks(){ const type=spreadSel.value; board.innerHTML=''; board.setAttribute('data-type',type); LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card,type,i)) ); afterDeal(type); }

function deal(){ board.classList.add('shuffle'); setTimeout(()=>board.classList.remove('shuffle'),250); board.setAttribute('aria-busy','true'); board.innerHTML=''; const type=spreadSel.value; board.setAttribute('data-type',type); const need=(POSITIONS[type]||['Mesaj']).length; if(pickMode.checked){ renderDeck(); summary.textContent= (langSel.value==='tr'?`SeÃ§meli mod: ${need} kart seÃ§.`:`Pick mode: choose ${need} cards.`); explain.hidden=false; board.removeAttribute('aria-busy'); return; } const d=TAROT.cards.slice(); shuffle(d); LAST_PICKS=d.slice(0,need).map(c=>({...c,reversed:allowRev.checked?(Math.random()<.5):false})); LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card,type,i)) ); afterDeal(type); }

function afterDeal(type){
  const qtxt = qInput.value.trim();
  const mapTR = {one:'Tek Kart hazÄ±r.',three:'3 Kart hazÄ±r.',celtic:'Kelt HaÃ§Ä± (10) hazÄ±r.',relation:'Ä°liÅŸki (6) hazÄ±r.'};
  const mapEN = {one:'One Card ready.',three:'3-Card ready.',celtic:'Celtic Cross ready.',relation:'Relationship spread ready.'};
  let txt = (langSel.value==='tr' ? mapTR[type] : mapEN[type]) || '';
  if (qtxt) txt += (langSel.value==='tr' ? ` Soru: â€œ${qtxt}â€.` : ` Question: â€œ${qtxt}â€.`);
  summary.textContent = txt + (langSel.value==='tr' ? ' Kartlara tÄ±klayarak Ã§evir.' : ' Click cards to flip.');
  explain.hidden = false;
  board.removeAttribute('aria-busy');

  // ğŸ” Otomatik flip â€“ #board iÃ§indeki kartlarÄ± sÄ±rayla, atlamasÄ±z
  if (autoFlip && autoFlip.checked) {
    const cards = Array.from(document.querySelectorAll('#board .tarot-card'));
    let i = 0;
    function tick() {
      if (i >= cards.length) return;
      const c = cards[i++];
      void c.offsetHeight;           // reflow
      c.classList.add('flipped');
      setTimeout(tick, 150);
    }
    requestAnimationFrame(() => setTimeout(tick, 120));
  }

  // ğŸ”— PaylaÅŸÄ±m + Kaydet
  const st = getState();
  saveLocal(st);
  const url = shareURL(st);
  sharebar.hidden = false;

  copyBtn.onclick = async () => {
    try {
      await navigator.clipboard.writeText(url);
      copyBtn.textContent = (langSel.value==='tr' ? 'KopyalandÄ±' : 'Copied');
      setTimeout(() => copyBtn.textContent = (langSel.value==='tr' ? 'Linki kopyala' : 'Copy link'), 1200);
    } catch(e){ alert(url); }
  };
  waBtn.onclick = () => {
    const t = encodeURIComponent(`${langSel.value==='tr'?'Tarot aÃ§Ä±lÄ±mÄ±m:':'My tarot spread:'}\n${url}`);
    window.open(`https://wa.me/?text=${t}`, '_blank');
  };
  xBtn.onclick = () => {
    const t = encodeURIComponent(`Tabirly Tarot â€” ${url}`);
    window.open(`https://twitter.com/intent/tweet?text=${t}`, '_blank');
  };
}

savePng?.addEventListener('click',async()=>{ try{ const node=board; const canvas=await html2canvas(node,{backgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--bg')||'#0b0d12',useCORS:true,scale:2}); const link=document.createElement('a'); link.download='tabirly-tarot.png'; link.href=canvas.toDataURL('image/png'); link.click(); }catch(e){ alert('GÃ¶rsel oluÅŸturulamadÄ± :(');} });

function applyTheme(){ document.documentElement.setAttribute('data-theme', themeSel.value); saveLocal(getState()); }
themeSel.addEventListener('change',applyTheme); langSel.addEventListener('change',()=>{ const st=getState(); saveLocal(st); if(LAST_PICKS.length){ drawFromPicks(); }});

dealBtn.addEventListener('click',deal); pickMode.addEventListener('change',()=>{ if(pickMode.checked){ renderDeck(); } else { deck.hidden=true; }});

(function init(){ const hash=new URLSearchParams(location.hash.slice(1)); let st=null; if(hash.get('s')){ try{ st=decodeState(hash.get('s')); }catch(e){} } if(!st){ st=loadLocal(); } if(st){ spreadSel.value=st.type||'one'; qInput.value=st.question||''; allowRev.checked=!!st.allowReversed; autoFlip.checked=!!st.autoFlip; showImages.checked=!!st.showImages; pickMode.checked=!!st.pickMode; langSel.value=st.lang||'tr'; themeSel.value=st.theme||'dark'; applyTheme(); } if(st && st.cards && st.cards.length){ board.setAttribute('data-type',st.type); LAST_PICKS=st.cards.map(k=>{const base=TAROT.cards.find(x=>x.name===k.name)||TAROT.cards[0]; return {...base,reversed:!!k.reversed};}); LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card, st.type, i)) ); let txt=(langSel.value==='tr'?(st.type==='three'?'3 Kart (yÃ¼kledi).':st.type==='celtic'?'Kelt HaÃ§Ä± (yÃ¼kledi).':st.type==='relation'?'Ä°liÅŸki (yÃ¼kledi).':'Tek Kart (yÃ¼kledi).'):(st.type==='three'?'3-Card (loaded).':st.type==='celtic'?'Celtic Cross (loaded).':st.type==='relation'?'Relationship (loaded).':'One Card (loaded).')); if(st.question) txt+= (langSel.value==='tr'?` Soru: â€œ${st.question}â€.`:` Question: â€œ${st.question}â€.`); summary.textContent=txt+(langSel.value==='tr'?' Kartlara tÄ±klayarak Ã§evir.':' Click cards to flip.'); explain.hidden=false; sharebar.hidden=false; if(pickMode.checked) renderDeck(); }
})();
</script>
</body>
</html>
