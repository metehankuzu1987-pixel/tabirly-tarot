<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tabirly | Tarot Tool v3</title>
<meta name="description" content="Tabirly tarot açılımları: Tek Kart, 3 Kart, Kelt Haçı, İlişki Açılımı. Seçmeli mod, paylaşım, localStorage, görsel opsiyonu." />
<meta property="og:title" content="Tabirly | Tarot Tool" />
<meta property="og:description" content="Tek Kart, 3 Kart, Kelt Haçı, İlişki açılımı—sonucu link olarak paylaş." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://tarot.tabirly.com" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%237f5af0'/><stop offset='1' stop-color='%23ffd166'/></linearGradient></defs><rect rx='14' width='64' height='64' fill='url(%23g)'/></svg>">
<style>
  :root{ --bg:#0b0d12; --card:#141827; --ink:#eef2f8; --muted:#a8b0c2; --acc:#ffd166; --ok:#06d6a0; --warn:#ef476f; --radius:18px; --gap:14px; --shadow:0 14px 40px rgba(0,0,0,.35); }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1100px 800px at 15% -10%,#1a1f33 0%,#0b0d12 55%), var(--bg);color:var(--ink);font:16px/1.6 system-ui,Inter,Roboto,Arial}
  .wrap{max-width:1000px;margin:28px auto;padding:0 16px 80px}
  header{display:flex;gap:16px;align-items:center;margin:0 0 16px}
  .logo{width:44px;height:44px;border-radius:12px;background:conic-gradient(from 0deg,#7f5af0,#00c2ff,#06d6a0,#ffd166,#7f5af0)}
  .hgroup h1{margin:0;font-size:22px}
  .hgroup p{margin:.25rem 0 0;color:var(--muted);font-size:14px}

  .panel{background:rgba(20,24,39,.65);border:1px solid rgba(255,255,255,.06);backdrop-filter:blur(6px);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
  .controls{display:grid;grid-template-columns:1fr 1fr auto;gap:var(--gap);align-items:end}
  @media(max-width:700px){.controls{grid-template-columns:1fr}}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  select,input{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0f1320;color:var(--ink);padding:10px;font:inherit}
  .row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
  .btn{border:0;border-radius:14px;padding:12px 16px;background:linear-gradient(180deg,#ffd166,#ffca54);color:#1f1a00;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(255,209,102,.25)}
  .btn.small{padding:8px 12px;font-weight:600}

  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:var(--gap);margin:18px 0}
  #board[data-type="celtic"]{grid-template-columns:repeat(5,1fr)}
  @media (max-width:900px){#board[data-type="celtic"]{grid-template-columns:repeat(3,1fr)}}
  #board[data-type="relation"]{grid-template-columns:repeat(3,1fr)}

  .tarot-card{position:relative;aspect-ratio:3/5;border-radius:16px;transform-style:preserve-3d;transition:transform .7s cubic-bezier(.2,.6,.2,1);box-shadow:var(--shadow);cursor:pointer}
  .tarot-card.flipped{transform:rotateY(180deg)}
  .tarot-card.is-reversed .front{transform:rotate(180deg)}
  .tarot-card .face{position:absolute;inset:0;display:grid;place-items:center;backface-visibility:hidden;border-radius:16px;overflow:hidden}
  .tarot-card .back{background:repeating-radial-gradient(circle at 50% 38%, #222a44 0 8px, #1a2240 8px 16px)}
  .tarot-card .front{transform:rotateY(180deg);background:#141a2d;padding:12px;text-align:center;border:1px solid rgba(255,255,255,.08);position:relative}
  .tarot-card .front img.bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.28;filter:contrast(1.05) saturate(1.1) brightness(.9)}
  .tarot-card .front .title,.tarot-card .front .mini,.pos-badge,.rev-badge{position:relative;z-index:2}
  .pos-badge{position:absolute;top:6px;left:6px;background:rgba(0,0,0,.5);padding:4px 8px;border-radius:10px;font-size:12px}
  .rev-badge{position:absolute;top:6px;right:6px;background:rgba(239,71,111,.92);color:#fff;padding:4px 8px;border-radius:10px;font-size:12px;display:none}
  .tarot-card.is-reversed .rev-badge{display:block}
  .title{font-weight:800;margin-top:8px}
  .mini{font-size:12px;color:var(--muted)}

  /* Shuffle animasyonu */
  @keyframes shuffleSpin{0%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}100%{transform:rotate(0)}}
  .shuffle .tarot-card{animation:shuffleSpin .25s ease both}

  footer{margin-top:28px;color:var(--muted);font-size:12px;text-align:center}
  .inline{display:flex;align-items:center;gap:10px}
  .muted{color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div class="hgroup">
        <h1>Tabirly Tarot v3</h1>
        <p>Tek Kart, 3 Kart, Kelt Haçı, İlişki • Seçmeli mod • Paylaş • LocalStorage</p>
      </div>
    </header>

    <section class="panel" aria-label="Açılım Ayarları">
      <div class="controls">
        <div>
          <label for="spread">Açılım türü</label>
          <select id="spread">
            <option value="one">Tek Kart</option>
            <option value="three">3 Kart (Geçmiş–Şimdi–Gelecek)</option>
            <option value="celtic">Kelt Haçı (10 kart)</option>
            <option value="relation">İlişki Açılımı (6 kart)</option>
          </select>
        </div>
        <div>
          <label for="question">Soru (isteğe bağlı)</label>
          <input id="question" type="text" placeholder="Örn. İlişkide nasıl ilerlemeliyim?">
        </div>
        <div>
          <button id="deal" class="btn">Kartları Çek</button>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <label class="inline"><input type="checkbox" id="allowReversed" checked style="accent-color:#ffd166"/> Ters kart çıkabilir</label>
        <label class="inline"><input type="checkbox" id="autoFlip" checked style="accent-color:#ffd166"/> Otomatik aç (flip)</label>
        <label class="inline"><input type="checkbox" id="showImages" style="accent-color:#ffd166"/> Kart görselleri</label>
        <label class="inline"><input type="checkbox" id="pickMode" style="accent-color:#ffd166"/> Seçmeli mod (kartları kendim seçeyim)</label>
      </div>
      <p class="muted">Görseller yoksa işaretleme. Açılımı paylaştığında linkten aynı sonuç açılır.</p>
    </section>

    <section class="panel" id="extras">
      <div class="row" id="sharebar" hidden>
        <button class="btn small" id="copyLink">Linki kopyala</button>
        <button class="btn small secondary" id="shareWa">WhatsApp</button>
        <button class="btn small secondary" id="shareX">X / Twitter</button>
      </div>
    </section>

    <section id="deck" class="grid" hidden aria-label="Deste"></section>
    <section id="board" class="grid" aria-live="polite" aria-busy="false"></section>

    <section id="explain" class="panel" hidden>
      <p id="summary">Kartlara tıklayarak çevir. Ayarlardan ters kartı ve otomatik flip’i yönet. Seçmeli mod açıkken, desteden sırasıyla gerekli sayıda kart seç.</p>
    </section>

    <footer><p>© Tabirly — Tarot Tool v3</p></footer>
  </div>

<script>
// ---- Tarot veri seti (kısa) ----
const TAROT = (()=>{
  const U = (upright, reversed) => ({upright, reversed});
  const majors = {"The Fool":U("Başlangıç, cesaret, akışa güven","Düşüncesizlik, hazırlıksız risk"),"The Magician":U("Niyet, odak, eylem gücü","Dağılan enerji, yanılsama"),"The High Priestess":U("Sezgi, sır, içe dönüş","Gizlilik, kopukluk"),"The Empress":U("Bereket, bakım, yaratım","Aşırı koruma, tıkanma"),"The Emperor":U("Düzen, yapı, otorite","Katılık, kontrol"),"The Hierophant":U("Gelenek, rehberlik","Kör uyum, dogma"),"The Lovers":U("Seçim, uyum, bağ","Kararsızlık, uyumsuzluk"),"The Chariot":U("İrade, yön, zafer","Dengesizlik"),"Strength":U("Sakin güç, sabır","Sabırsızlık"),"The Hermit":U("İç arayış","İzolasyon"),"Wheel of Fortune":U("Döngü, fırsat","Talihsizlik döngüsü"),"Justice":U("Adalet, denge","Haksızlık"),"The Hanged Man":U("Bakış açısı değişimi","Tutukluk"),"Death":U("Bitiş ve dönüşüm","Değişime direnç"),"Temperance":U("Denge, ılımlılık","Aşırılık"),"The Devil":U("Bağ, gölge","Kurtuluş"),"The Tower":U("Ani yıkım, uyanış","Geciken kriz"),"The Star":U("Umut, ilham","Şüphe"),"The Moon":U("Belirsizlik, sezgi","Yanılsama"),"The Sun":U("Netlik, başarı","Aşırı iyimserlik"),"Judgement":U("Çağrı, yenilenme","Erteleme"),"The World":U("Tamamlanma","Eksik halka")};
  const SUITS=[{suit:'Cups',up:['Duygu, akış, bağ','İki kişi, uyum','Kutlama, topluluk','Duygusal çekilme','Hayal kırıklığı','Nostalji','Hayaller, seçenekler','Veda, yolculuk','Dilek, tatmin','Duygusal tamamlanma']},{suit:'Pentacles',up:['Fırsat, tohum','Denge, jonglörlük','Ustalık, işbirliği','Tutunma, güvenlik','Yoksunluk, soğuk','Paylaşım, yardım','Sabır, hasat','Ustalık, emek','Öz-değer, konfor','Maddi tamamlanma']},{suit:'Swords',up:['Zihin açıklığı','Kararsızlık','Acı, kırık kalp','Dinlenme, toparlanma','Çatışma','Geçiş, sığınma','Strateji, gizlilik','Sıkışmış his','Endişe','Zihinsel çöküş']},{suit:'Wands',up:['Kıvılcım, ilham','Ufuk planı','Genişleme','Kutlama, temel','Rekabet','Zafer','Savunma','Hız, haber','Direnç','Yük, sorumluluk']}];
  const courtUp={Cups:['Hassas haberci','Romantik yolculuk','Şefkatli yönetici','Duygusal lider'],Pentacles:['Öğrenci, pratik adım','Güvenilir ilerleyiş','Kaynak yönetimi','Maddi liderlik'],Swords:['Meraklı zihin','Atılgan eylemci','Keskin karar','Mantık lideri'],Wands:['Yaratıcı kıvılcım','Macera ruhu','Karizmatik yönetici','Vizyoner lider']};
  const reversedHint={Cups:['Aşırı duyarlılık','Kaçışçılık','Manipülasyon','Soğukluk'],Pentacles:['Üşengeçlik','Oyalama','Açgözlülük','İnatçı kontrol'],Swords:['Dedikodu','Düşüncesiz saldırı','Zalimlik','Katı zihin'],Wands:['Yönsüz heves','Dürtüsellik','Tükenmişlik','Tiranlık']};
  const cards=[];Object.keys(majors).forEach(k=>cards.push({name:k,...majors[k]}));
  const R=['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten'];
  SUITS.forEach(({suit,up})=>{up.forEach((txt,i)=>cards.push({name:`${R[i]} of ${suit}`,upright:txt,reversed:reversedHint[suit][Math.min(i,reversedHint[suit].length-1)]}));['Page','Knight','Queen','King'].forEach((r,i)=>cards.push({name:`${r} of ${suit}`,upright:courtUp[suit][i],reversed:reversedHint[suit][i]}));});
  const TR={Cups:'Kupa',Pentacles:'Tılsım',Swords:'Kılıç',Wands:'Değnek',Ace:'As',Two:'İki',Three:'Üç',Four:'Dört',Five:'Beş',Six:'Altı',Seven:'Yedi',Eight:'Sekiz',Nine:'Dokuz',Ten:'On',Page:'Uşak',Knight:'Şövalye',Queen:'Kraliçe',King:'Kral','The Fool':'Deli','The Magician':'Büyücü','The High Priestess':'Başrahibe','The Empress':'İmparatoriçe','The Emperor':'İmparator','The Hierophant':'Aziz','The Lovers':'Aşıklar','The Chariot':'Savaş Arabası','Strength':'Güç','The Hermit':'Ermiş','Wheel of Fortune':'Kader Çarkı','Justice':'Adalet','The Hanged Man':'Asılan Adam','Death':'Ölüm','Temperance':'Denge','The Devil':'Şeytan','The Tower':'Kule','The Star':'Yıldız','The Moon':'Ay','The Sun':'Güneş','Judgement':'Mahkeme','The World':'Dünya'};
  const trName=name=>name.includes(' of ')?(()=>{const [rank,suit]=name.split(' of ');return `${TR[suit]||suit} ${TR[rank]||rank}`;})():TR[name]||name;
  return {cards,trName};
})();

const POSITIONS={one:["Mesaj"],three:["Geçmiş","Şimdi","Gelecek"],celtic:["Durum (Şimdi)","Engel/Çapraz","Geçmiş Temel","Yakın Gelecek","Bilinç/Hedef","Bilinçaltı/Kök","Öneri/Ben","Çevre/Dış Etki","Umutlar & Korkular","Olası Sonuç"],relation:["Sen","Partner","Bağ/Dinamik","Güçlü Yanlar","Zorluklar","Olası Sonuç"]};

const qs=s=>document.querySelector(s);const qsa=s=>Array.from(document.querySelectorAll(s));
const el=(t,c)=>{const x=document.createElement(t);if(c)x.className=c;return x};
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a}
const slug=name=>name.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

// UI
const board=qs('#board'), deck=qs('#deck');
const dealBtn=qs('#deal'), spreadSel=qs('#spread'), qInput=qs('#question');
const allowRev=qs('#allowReversed'), autoFlip=qs('#autoFlip'), showImages=qs('#showImages'), pickMode=qs('#pickMode');
const summary=qs('#summary'), explain=qs('#explain');
const sharebar=qs('#sharebar'), copyBtn=qs('#copyLink'), waBtn=qs('#shareWa'), xBtn=qs('#shareX');

const KEY='tabirly_tarot_last_v3';
const encodeState=obj=>btoa(unescape(encodeURIComponent(JSON.stringify(obj))));
const decodeState=str=>JSON.parse(decodeURIComponent(escape(atob(str))));
let LAST_PICKS=[];

function getState(){return{type:spreadSel.value,question:qInput.value.trim(),allowReversed:!!allowRev.checked,autoFlip:!!autoFlip.checked,showImages:!!showImages.checked,pickMode:!!pickMode.checked,cards:LAST_PICKS.map((p,i)=>({name:p.name,reversed:p.reversed,pos:i}))}};
function saveLocal(st){try{localStorage.setItem(KEY,JSON.stringify(st));}catch(e){}}
function loadLocal(){try{return JSON.parse(localStorage.getItem(KEY)||'null');}catch(e){return null}}
function shareURL(st){const s=encodeState(st);return `${location.origin}${location.pathname}#s=${s}`}

function renderCard(card,type,idx){
  const c=el('div','tarot-card'); if(card.reversed)c.classList.add('is-reversed'); c.setAttribute('role','button'); c.tabIndex=0;
  const back=el('div','face back'); back.innerHTML='<span style="color:#ffd166;font-weight:800">TABIRLY</span>';
  const front=el('div','face front');
  const pos=POSITIONS[type][idx]||`Kart ${idx+1}`;
  const title=TAROT.trName(card.name);
  const meaning=card.reversed?card.reversed:card.upright;
  if(showImages && showImages.checked){ const img=new Image(); img.className='bg'; img.alt=''; img.loading='lazy'; img.src=`img/${slug(card.name)}.jpg`; img.onerror=()=>img.remove(); front.appendChild(img); }
  front.innerHTML+=`<div class="pos-badge">${pos}</div><div class="rev-badge">TERS</div><div class="title">${title}</div><div class="mini">${meaning}</div>`;
  c.append(back,front);
  c.addEventListener('click',()=>c.classList.toggle('flipped'));
  c.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.classList.toggle('flipped');}});
  return c;
}

function renderDeck(){
  deck.innerHTML=''; deck.hidden=!pickMode.checked; if(deck.hidden) return;
  const type=spreadSel.value, need=(POSITIONS[type]||['Mesaj']).length; let picked=0; LAST_PICKS=[];
  const d=TAROT.cards.slice(); shuffle(d);
  d.forEach((card,i)=>{
    const c=el('div','tarot-card'); c.setAttribute('aria-label','Seç');
    const back=el('div','face back'); const front=el('div','face front'); front.innerHTML='<div class="title">Seçildi</div>';
    c.append(back,front);
    c.addEventListener('click',()=>{
      if(c.classList.contains('chosen')) return; if(picked>=need) return;
      const reversed=allowRev.checked?(Math.random()<.5):false; LAST_PICKS.push({...card,reversed}); picked++; c.classList.add('chosen','flipped');
      if(picked===need){ drawFromPicks(); }
    });
    deck.appendChild(c);
  });
}

function drawFromPicks(){
  const type=spreadSel.value; board.innerHTML=''; board.setAttribute('data-type',type);
  LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card,type,i)) );
  afterDeal(type);
}

function deal(){
  board.classList.add('shuffle'); setTimeout(()=>board.classList.remove('shuffle'),250);
  board.setAttribute('aria-busy','true'); board.innerHTML='';
  const type=spreadSel.value; board.setAttribute('data-type',type); const need=(POSITIONS[type]||['Mesaj']).length;
  if(pickMode.checked){ renderDeck(); summary.textContent=`Seçmeli mod: ${need} kart seç.`; explain.hidden=false; board.removeAttribute('aria-busy'); return; }
  const deckArr=TAROT.cards.slice(); shuffle(deckArr); LAST_PICKS=deckArr.slice(0,need).map(c=>({...c,reversed:allowRev.checked?(Math.random()<.5):false}));
  LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card,type,i)) );
  afterDeal(type);
}

function afterDeal(type){
  const qtxt=qInput.value.trim(); let txt= type==='three'?'3 Kart açılımı hazır.':(type==='celtic'?'Kelt Haçı (10) hazır.':(type==='relation'?'İlişki (6) hazır.':'Tek Kart hazır.'));
  if(qtxt) txt+=` Soru: “${qtxt}”.`; summary.textContent=txt+' Kartlara tıklayarak çevir.'; explain.hidden=false; board.removeAttribute('aria-busy');
  if(autoFlip.checked){ setTimeout(()=> qsa('.tarot-card').forEach((c,idx)=> setTimeout(()=>c.classList.add('flipped'), idx*160)), 120); }
  const st=getState(); saveLocal(st); const url=shareURL(st); sharebar.hidden=false;
  copyBtn.onclick=async()=>{ try{ await navigator.clipboard.writeText(url); copyBtn.textContent='Kopyalandı'; setTimeout(()=>copyBtn.textContent='Linki kopyala',1200);}catch(e){ alert(url);} };
  waBtn.onclick=()=>{ const t=encodeURIComponent(`Tarot açılımım:\n${url}`); window.open(`https://wa.me/?text=${t}`,'_blank'); };
  xBtn.onclick=()=>{ const t=encodeURIComponent(`Tarot açılımım – Tabirly ${url}`); window.open(`https://twitter.com/intent/tweet?text=${t}`,'_blank'); };
}

dealBtn.addEventListener('click',deal); pickMode.addEventListener('change',()=>{ if(pickMode.checked){ renderDeck(); } else { deck.hidden=true; }});

(function init(){
  const hash=new URLSearchParams(location.hash.slice(1)); let st=null; if(hash.get('s')){ try{ st=decodeState(hash.get('s')); }catch(e){} }
  if(!st){ st=loadLocal(); }
  if(st && st.cards && st.cards.length){ spreadSel.value=st.type||'one'; qInput.value=st.question||''; allowRev.checked=!!st.allowReversed; autoFlip.checked=!!st.autoFlip; showImages.checked=!!st.showImages; pickMode.checked=!!st.pickMode;
    board.setAttribute('data-type',st.type); LAST_PICKS=st.cards.map(k=>{const base=TAROT.cards.find(x=>x.name===k.name)||TAROT.cards[0]; return {...base,reversed:!!k.reversed};});
    LAST_PICKS.forEach((card,i)=> board.appendChild(renderCard(card, st.type, i)) );
    let txt=st.type==='three'?'3 Kart açılımı (yükledi).':(st.type==='celtic'?'Kelt Haçı (yükledi).':(st.type==='relation'?'İlişki (yükledi).':'Tek Kart (yükledi).')); if(st.question) txt+=` Soru: “${st.question}”.`; summary.textContent=txt+' Kartlara tıklayarak çevir.'; explain.hidden=false; sharebar.hidden=false; if(pickMode.checked) renderDeck();
  }
})();
</script>
</body>
</html>
